name: Deploy Heroku

on:
  push:
    branches:
      - development
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: 'Checkout Github Action'
      uses: actions/checkout@v2
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 5.0.203
    - name: Publish
      uses: cake-build/cake-action@v1
      with:
        target: Publish
    - name: Docker Build
      uses: cake-build/cake-action@v1
      with:
        target: Docker-Build
    - name: Read version.md
      id: package
      uses: juliangruber/read-file-action@v1
      with:
        path: ./version.md
    - name: Check Dockerfile for Sysdig
      uses: sysdiglabs/scan-action@v3
      with:
        sysdig-secure-url: "https://eu1.app.sysdig.com"
        sysdig-secure-token: ${{ secrets.SYSDIG_SECURE_TOKEN }}
        image-tag: ghcr.io/weather-forecast-api:"${{ steps.package.outputs.content }}"
        input-type: docker-daemon



